<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Wallboard - Real-time Dashboard</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #e0eafc 0%, #3498db 100%);
            color: #222;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #232526 0%, #0f2027 100%);
            color: #e0eafc;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 24px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .widget {
            background: rgba(255, 255, 255, 0.85);
            padding: 28px 22px;
            border-radius: 18px;
            box-shadow: 0 4px 24px rgba(52, 152, 219, 0.12), 0 1.5px 6px rgba(44, 62, 80, 0.08);
            border: none;
            transition: box-shadow 0.2s;
        }

        body.dark-mode .widget {
            background: rgba(44, 62, 80, 0.92);
            color: #e0eafc;
            box-shadow: 0 4px 24px rgba(44, 62, 80, 0.18), 0 1.5px 6px rgba(44, 62, 80, 0.12);
        }

        .widget:hover {
            box-shadow: 0 8px 32px rgba(52, 152, 219, 0.18), 0 2px 8px rgba(44, 62, 80, 0.12);
        }

        .widget h3 {
            margin: 0 0 18px 0;
            font-size: 1.25em;
            text-align: center;
            color: #3498db;
        }

        body.dark-mode .widget h3 {
            color: #6dd5fa;
        }

        .header {
            grid-column: 1 / -1;
            text-align: center;
            margin-bottom: 24px;
        }

        .header h1 {
            color: #2980b9;
            font-size: 2.2em;
            margin-bottom: 8px;
        }

        body.dark-mode .header h1 {
            color: #6dd5fa;
        }

        .clock {
            font-size: 2.2em;
            text-align: center;
            font-weight: bold;
            margin: 22px 0;
            color: #222;
        }

        body.dark-mode .clock {
            color: #e0eafc;
        }

        .status-indicator {
            display: inline-block;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-available {
            background: #2ecc71;
        }

        .status-busy {
            background: #e74c3c;
        }

        .status-break {
            background: #f39c12;
        }

        .status-offline {
            background: #95a5a6;
        }

        .agent-item {
            background: rgba(52, 152, 219, 0.07);
            padding: 12px 10px;
            margin: 6px 0;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 4px rgba(52, 152, 219, 0.07);
        }

        body.dark-mode .agent-item {
            background: rgba(52, 152, 219, 0.13);
            color: #e0eafc;
        }

        .button {
            background: linear-gradient(90deg, #3498db 0%, #6dd5fa 100%);
            border: none;
            color: white;
            padding: 10px 22px;
            border-radius: 24px;
            cursor: pointer;
            margin: 7px 4px;
            font-size: 1em;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.08);
            transition: background 0.3s, color 0.3s, box-shadow 0.2s;
        }

        body.dark-mode .button {
            background: linear-gradient(90deg, #232526 0%, #6dd5fa 100%);
            color: #e0eafc;
        }

        body.dark-mode .button:hover {
            background: linear-gradient(90deg, #6dd5fa 0%, #232526 100%);
            color: #232526;
        }

        .loading {
            text-align: center;
            opacity: 0.7;
            font-style: italic;
            color: #2980b9;
        }

        body.dark-mode .loading {
            color: #6dd5fa;
        }

        .error {
            color: #e74c3c;
            font-size: 1em;
            font-weight: 500;
            margin-bottom: 6px;
        }

        body.dark-mode .error {
            color: #e74c3c;
        }

        .websocket-status {
            padding: 12px;
            border-radius: 10px;
            margin: 12px 0;
            text-align: center;
            font-size: 1.1em;
        }

        body.dark-mode .ws-connected {
            background: rgba(46, 204, 113, 0.22);
            color: #2ecc71;
        }

        body.dark-mode .ws-disconnected {
            background: rgba(231, 76, 60, 0.22);
            color: #e74c3c;
        }

        body.dark-mode .ws-connecting {
            background: rgba(243, 156, 18, 0.22);
            color: #f39c12;
        }

        @media (max-width: 900px) {
            .dashboard {
                grid-template-columns: 1fr;
                gap: 18px;
            }

            .widget {
                padding: 18px 8px;
            }
        }

        @media (max-width: 600px) {
            body {
                padding: 8px;
            }

            .dashboard {
                gap: 10px;
            }

            .widget {
                padding: 12px 2px;
            }

            .clock {
                font-size: 1.3em;
            }

            .simulator-widget {
            min-width: 320px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            box-shadow: 0 2px 12px rgba(52,152,219,0.10);
        }
        @media (max-width: 900px) {
            .simulator-widget {
                max-width: 100%;
                margin-top: 18px;
            }
        }
        }
    </style>
</head>

<body>
    <div class="dashboard">
        <!-- Header -->
        <div class="header widget">
            <h1>üè¢ Agent Wallboard Dashboard</h1>
            <p>Real-time Monitoring System</p>
            <div class="clock" id="liveClock">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤...</div>
        </div>

        <!-- Metrics Widget -->
        <div class="widget">
            <h3>üìä Agent Metrics</h3>
            <div id="agentMetrics" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥...</div>
        </div>

        <!-- Weather Widget -->
        <div class="widget">
            <h3>üå§Ô∏è ‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®</h3>
            <div id="weatherInfo" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
            <button class="button" onclick="refreshWeather()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
        </div>

        <!-- System Status -->
        <div class="widget">
            <h3>‚ö° WebSocket Status</h3>
            <div id="websocketStatus" class="websocket-status ws-disconnected">
                üî¥ ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
            </div>
            <button class="button" onclick="connectWebSocket()">üîå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</button>
            <button class="button" onclick="sendTestMessage()">üí¨ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö</button>
        </div>

        <!-- Real-time Clock -->
        <div class="widget">
            <h3>üïí ‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏≤‡∏Å API</h3>
            <div id="apiTime" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
            <button class="button" onclick="refreshTime()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
        </div>

        <!-- Agents List -->
        <div class="widget" style="grid-column: span 2;">
            <h3>üë• Agent Status (Mock Data)</h3>
            <div id="agentsList" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ agents...</div>
            <button class="button" onclick="refreshAgents()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä Agents</button>
            <button class="button" onclick="startAutoRefresh()">‚è∞ Auto Refresh</button>
            <button class="button" onclick="stopAutoRefresh()">‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î Auto</button>
        </div>
    </div>

    <!-- Agent Simulator Widget -->
    <div class="widget simulator-widget" style="grid-column: span 2; margin-top: 24px;">
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
            <h3 style="margin:0;display:flex;align-items:center;gap:8px;">üé≠ <span style="color:#3498db;">Agent Status Simulator</span></h3>
            <div>
                <button class="button" onclick="startSimulator()" style="margin-right:8px;">‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏° Simulator</button>
                <button class="button" onclick="stopSimulator()">‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î Simulator</button>
            </div>
        </div>
        <p style="margin-bottom:18px; color:#666;">‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏ö‡∏ö real-time ‡∏Ç‡∏≠‡∏á agent ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö dashboard</p>
        <div id="simulatorStatus" style="margin-bottom: 12px; font-size:1.1em; font-weight:500; color:#27ae60;">
            üìç Simulator ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
        </div>
        <div id="lastStatusChange" style="font-size: 1em; color:#2980b9; background:rgba(52,152,219,0.07); border-radius:8px; padding:8px;">
            ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á...
        </div>
    </div>
        

    <button id="toggleModeBtn" class="button" style="position:fixed; top:20px; right:20px; z-index:100;">
        üåô Dark Mode
    </button>

    <script>
        console.log('üé® [RENDERER] Real-time Dashboard ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß');

        // Global variables
        let websocket = null;
        let autoRefreshInterval = null;
        let clockInterval = null;

        // Dark mode toggle
        const toggleBtn = document.getElementById('toggleModeBtn');
        let darkMode = false;
        toggleBtn.addEventListener('click', () => {
            darkMode = !darkMode;
            document.body.classList.toggle('dark-mode', darkMode);
            toggleBtn.textContent = darkMode ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
        });

        // ===== WEBSOCKET FUNCTIONS =====

        function connectWebSocket() {
            try {
                console.log('‚ö° [RENDERER] ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ WebSocket...');
                updateWebSocketStatus('connecting', 'üü° ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...');

                // ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ WebSocket Echo Test
                websocket = new WebSocket('wss://echo.websocket.org/');

                websocket.onopen = function (event) {
                    console.log('‚úÖ [RENDERER] WebSocket ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß');
                    updateWebSocketStatus('connected', 'üü¢ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß');

                    // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö
                    websocket.send(JSON.stringify({
                        type: 'wallboard_connected',
                        message: 'Agent Wallboard ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß',
                        timestamp: new Date().toISOString()
                    }));
                };

                websocket.onmessage = function (event) {
                    console.log('üì® [RENDERER] ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°:', event.data);

                    try {
                        const data = JSON.parse(event.data);
                        handleWebSocketMessage(data);
                    } catch (error) {
                        console.log('üì® [RENDERER] Text message:', event.data);
                    }
                };

                websocket.onclose = function (event) {
                    console.log('üî¥ [RENDERER] WebSocket ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠');
                    updateWebSocketStatus('disconnected', 'üî¥ ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠');
                    websocket = null;
                };

                websocket.onerror = function (error) {
                    console.error('‚ùå [RENDERER] WebSocket error:', error);
                    updateWebSocketStatus('disconnected', '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
                };

            } catch (error) {
                console.error('‚ùå [RENDERER] Error:', error);
                updateWebSocketStatus('disconnected', '‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ');
            }
        }

        function sendTestMessage() {
            if (websocket && websocket.readyState === WebSocket.OPEN) {
                const testMessage = {
                    type: 'agent_status_update',
                    agentId: 'AG001',
                    newStatus: 'Available',
                    timestamp: new Date().toISOString(),
                    message: '‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å Agent Wallboard'
                };

                console.log('üí¨ [RENDERER] ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö...');
                websocket.send(JSON.stringify(testMessage));
            } else {
                alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ WebSocket ‡∏Å‡πà‡∏≠‡∏ô');
            }
        }

        function updateWebSocketStatus(status, message) {
            const statusEl = document.getElementById('websocketStatus');
            statusEl.className = `websocket-status ws-${status}`;
            statusEl.textContent = message;
        }

        function handleWebSocketMessage(data) {
            console.log('üîÑ [RENDERER] ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°:', data);

            // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó agent status ‡πÅ‡∏ö‡∏ö real-time
            if (data.type === 'agent_status_update') {
                showNotification(`üîÑ ${data.agentId} ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô ${data.newStatus}`);
            }
        }

        // ===== API FUNCTIONS =====

        async function refreshTime() {
            try {
                console.log('üïí [RENDERER] ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡πÄ‡∏ß‡∏•‡∏≤...');
                document.getElementById('apiTime').innerHTML = '<div class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>';

                const timeData = await window.realtimeAPI.getWorldTime();

                if (timeData.success) {
                    document.getElementById('apiTime').innerHTML = `
            <strong>üïí ${timeData.formatted}</strong><br>
            <small>Timezone: ${timeData.timezone}</small>
          `;
                } else {
                    document.getElementById('apiTime').innerHTML = `
            <div class="error">‚ùå ${timeData.error}</div>
            <div>Fallback: ${timeData.fallback}</div>
          `;
                }

            } catch (error) {
                console.error('‚ùå [RENDERER] Error:', error);
                document.getElementById('apiTime').innerHTML = `<div class="error">‚ùå ${error.message}</div>`;
            }
        }

        async function refreshWeather() {
            try {
                console.log('üå§Ô∏è [RENDERER] ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®...');
                document.getElementById('weatherInfo').innerHTML = '<div class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>';

                const weatherData = await window.realtimeAPI.getWeather();

                if (weatherData.success) {
                    document.getElementById('weatherInfo').innerHTML = `
            <strong>üìç ${weatherData.location}</strong><br>
            üå°Ô∏è ${weatherData.temperature}<br>
            ‚òÅÔ∏è ${weatherData.description}<br>
            üíß ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô: ${weatherData.humidity}
          `;
                } else {
                    const fallback = weatherData.fallback;
                    document.getElementById('weatherInfo').innerHTML = `
            <div class="error">‚ö†Ô∏è ${weatherData.error}</div>
            <div><strong>üìç ${fallback.location}</strong><br>
            üå°Ô∏è ${fallback.temperature}<br>
            ‚òÅÔ∏è ${fallback.description}</div>
          `;
                }

            } catch (error) {
                console.error('‚ùå [RENDERER] Error:', error);
                document.getElementById('weatherInfo').innerHTML = `<div class="error">‚ùå ${error.message}</div>`;
            }
        }

        async function refreshAgents() {
                        try {
                                console.log('üë• [RENDERER] ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä agents...');
                                document.getElementById('agentsList').innerHTML = '<div class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>';

                                const agentData = await window.realtimeAPI.getMockAgents();

                                // Metrics calculation
                                if (agentData.success) {
                                        let agentsHTML = '';
                                        let metricsHTML = '';

                                        // Count by status
                                        const statusCount = { Available: 0, Busy: 0, Break: 0, Offline: 0 };
                                        agentData.agents.forEach(agent => {
                                                const statusClass = `status-${agent.status.toLowerCase()}`;
                                                agentsHTML += `
                            <div class="agent-item">
                                <div>
                                    <span class="status-indicator ${statusClass}"></span>
                                    <strong>${agent.name}</strong> (${agent.id})
                                </div>
                                <div>
                                    ${agent.status} | Ext: ${agent.extension}
                                </div>
                            </div>
                        `;
                                                if (statusCount[agent.status] !== undefined) statusCount[agent.status]++;
                                        });

                                        // Metrics summary
                                        metricsHTML += `<div style="margin-bottom:8px;">
                                                üë• <strong>Agents ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</strong> ${agentData.count}<br>
                                                ÔøΩ <strong>Available:</strong> ${statusCount.Available}
                                                üî¥ <strong>Busy:</strong> ${statusCount.Busy}
                                                üü† <strong>Break:</strong> ${statusCount.Break}
                                                ‚ö´ <strong>Offline:</strong> ${statusCount.Offline}<br>
                                                <span style="font-size:0.95em;">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${new Date(agentData.timestamp).toLocaleString('th-TH')}</span>
                                        </div>`;

                                        // Ratio
                                        const availableRatio = agentData.count > 0 ? Math.round((statusCount.Available / agentData.count) * 100) : 0;
                                        metricsHTML += `<div style="margin-top:6px;">
                                                ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏ß‡πà‡∏≤‡∏á‡∏á‡∏≤‡∏ô: <strong>${availableRatio}%</strong>
                                        </div>`;

                                        metricsHTML += `<div style="margin-top:6px; font-size:0.9em;">
                                                ${agentData.fallback ? '‚ö†Ô∏è ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏£‡∏≠‡∏á' : '‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏î‡∏à‡∏≤‡∏Å API'}
                                        </div>`;

                                        document.getElementById('agentsList').innerHTML = agentsHTML;
                                        document.getElementById('agentMetrics').innerHTML = metricsHTML;
                                } else {
                                        document.getElementById('agentsList').innerHTML = `<div class="error">‚ùå ${agentData.error}</div>`;
                                        document.getElementById('agentMetrics').innerHTML = `<div class="error">‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÑ‡∏î‡πâ</div>`;
                                }

                        } catch (error) {
                                console.error('‚ùå [RENDERER] Error:', error);
                                document.getElementById('agentsList').innerHTML = `<div class="error">‚ùå ${error.message}</div>`;
                                document.getElementById('agentMetrics').innerHTML = `<div class="error">‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÑ‡∏î‡πâ</div>`;
                        }
        }

        // ===== AUTO REFRESH FUNCTIONS =====

        function startAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }

            console.log('‚è∞ [RENDERER] ‡πÄ‡∏£‡∏¥‡πà‡∏° auto refresh...');

            // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏ó‡∏∏‡∏Å 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            autoRefreshInterval = setInterval(() => {
                console.log('üîÑ [RENDERER] Auto refresh...');
                refreshAgents();
                refreshTime();
            }, 30000);

            showNotification('‚è∞ ‡πÄ‡∏£‡∏¥‡πà‡∏° Auto Refresh ‡πÅ‡∏•‡πâ‡∏ß (‡∏ó‡∏∏‡∏Å 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)');
        }

        function stopAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
                console.log('‚èπÔ∏è [RENDERER] ‡∏´‡∏¢‡∏∏‡∏î auto refresh');
                showNotification('‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î Auto Refresh ‡πÅ‡∏•‡πâ‡∏ß');
            }
        }

        // ===== UTILITY FUNCTIONS =====

        function updateLiveClock() {
            const now = new Date();
            document.getElementById('liveClock').textContent = now.toLocaleString('th-TH');
        }

        function showNotification(message) {
            // ‡∏à‡∏≥‡∏•‡∏≠‡∏á notification (‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ console.log)
            console.log('üîî [NOTIFICATION]', message);

            // ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ alert ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö
            // alert(message);
        }

        // ===== INITIALIZATION =====

        window.addEventListener('DOMContentLoaded', () => {
            console.log('üìÑ [RENDERER] DOM ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß');

            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô live clock
            clockInterval = setInterval(updateLiveClock, 1000);
            updateLiveClock();

            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            refreshTime();
            refreshWeather();
            refreshAgents();

            console.log('‚úÖ [RENDERER] Dashboard ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
        });

        // Cleanup ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î window
        window.addEventListener('beforeunload', () => {
            console.log('üîÑ [RENDERER] ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î...');

            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }

            if (clockInterval) {
                clearInterval(clockInterval);
            }

            if (websocket) {
                websocket.close();
            }
        });

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ô <script> ‡∏Ç‡∏≠‡∏á index.html

        // ===== SIMULATOR FUNCTIONS =====

        async function startSimulator() {
            try {
                console.log('üé≠ [RENDERER] ‡πÄ‡∏£‡∏¥‡πà‡∏° simulator...');

                const result = await window.realtimeAPI.startSimulator();

                if (result.success) {
                    document.getElementById('simulatorStatus').innerHTML = 'üü¢ Simulator ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà';
                    showNotification('üé≠ Agent Status Simulator ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß');
                }

            } catch (error) {
                console.error('‚ùå [RENDERER] Error:', error);
            }
        }

        async function stopSimulator() {
            try {
                console.log('‚èπÔ∏è [RENDERER] ‡∏´‡∏¢‡∏∏‡∏î simulator...');

                const result = await window.realtimeAPI.stopSimulator();

                if (result.success) {
                    document.getElementById('simulatorStatus').innerHTML = 'üî¥ Simulator ‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß';
                    showNotification('‚èπÔ∏è Agent Status Simulator ‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß');
                }

            } catch (error) {
                console.error('‚ùå [RENDERER] Error:', error);
            }
        }

        // ‡∏£‡∏±‡∏ö event ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏≤‡∏Å simulator
        window.realtimeAPI.onAgentStatusChanged((data) => {
            console.log('üì° [RENDERER] Agent status changed:', data);

            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó UI
            document.getElementById('lastStatusChange').innerHTML = `
    üîÑ <strong>${data.agentId}</strong> ‚Üí ${data.newStatus}<br>
    <small>‚è∞ ${new Date(data.timestamp).toLocaleTimeString('th-TH')}</small>
  `;

            // ‡πÅ‡∏™‡∏î‡∏á notification
            showNotification(`üîÑ ${data.agentId} ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô ${data.newStatus}`);

            // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä agents list
            refreshAgents();
        });
    </script>
</body>

</html>